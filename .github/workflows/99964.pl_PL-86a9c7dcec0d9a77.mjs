"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[99964],{479511:(e,t,r)=>{r.d(t,{At:()=>d,ZP:()=>c,mQ:()=>s,sI:()=>o});var i=r(745111),a=r(953565);let n="CREATE_STERLING_CACHE_ACTION",_="UPDATE_STERLING_CACHE_ACTION",s={LOAD_REPORTING_TABLE:"reportingTableLoadDataV2",LOAD_REPORTING_TABLE_SUMMARY:"reportingTableLoadSummaryV2",LOAD_ACTIVE_ENTITIES:"reportingActiveEntities"},o={[s.LOAD_REPORTING_TABLE]:["STERLING_REPORTING_TABLE_UPDATE_ROW_DATA","STERLING_SET_SELECTED_ROWS_DATA","STERLING_REPORTING_TABLE_KEYWORD_UPDATED"]},d=(e,t={})=>{let r=Object.entries(t).reduce((e,[t,r])=>(r.forEach(r=>{e[r]?e[r].push(t):e[r]=[t]}),e),{}),i=e.reduce((e,t)=>({...e,[t]:{size:0,history:{}}}),{});return(e=i,t)=>{switch(t.type){case n:let a=t.payload.hashKey in e[t.payload.registerKey].history;return{...e,[t.payload.registerKey]:{size:a?e[t.payload.registerKey].size:e[t.payload.registerKey].size+1,history:{...e[t.payload.registerKey].history,[t.payload.hashKey]:{createdAt:t.payload.createdAt,actionList:t.payload.actionList}}}};case _:let s=Object.entries(e[t.payload.registerKey].history).sort((e,t)=>t[1].createdAt-e[1].createdAt).reduce((e,[r,i],a)=>(a<t.payload.limit&&i.createdAt>t.payload.expireBefore&&(e.history[r]=i,e.size+=1),e),{size:0,history:{}});return{...e,[t.payload.registerKey]:s};default:if(t.type in r)return r[t.type].reduce((e,t)=>(e[t]={size:0,history:{}},e),e);return e}}},u={maxItems:100,expireTime:5e5};class c{constructor(e,t,r=u){var s,o,d;if(s="getCacheThunkAction",o=e=>(...t)=>async(r,s)=>{let o=[],d=s(),u=this.paramsGenerator(s(),...t),c=`param-${(0,i.Z)(JSON.stringify(u))||""}`,{sterlingCache:l}=d;if(!l[this.registerKey])throw Error(`please register key: ${this.registerKey} in reduxCachingReducer`);let p=l[this.registerKey].history[c],m=new Date;if(!p||p.createdAt+this.config.expireTime<m.getTime())(0,a.nP)("sterling.thunk_cache.miss",{sampleRate:1,tags:{register_key:this.registerKey}}),await e(...t)(e=>(o.push(e),r(e)),s),r({type:n,payload:{registerKey:this.registerKey,hashKey:c,actionList:o,createdAt:m.getTime()}}),r({type:_,payload:{registerKey:this.registerKey,expireBefore:m.getTime()-this.config.expireTime,limit:this.config.maxItems}}),(0,a.LY)("sterling.thunk_cache.latency",new Date().getTime()-m.getTime(),{sampleRate:.1,tags:{register_key:this.registerKey,status:"miss"}});else(0,a.nP)("sterling.thunk_cache.hit",{sampleRate:1,tags:{register_key:this.registerKey}}),p.actionList.forEach(e=>{r(e)}),(0,a.LY)("sterling.thunk_cache.latency",new Date().getTime()-m.getTime(),{sampleRate:.1,tags:{register_key:this.registerKey,status:"hit"}});return null},(s="symbol"==typeof(d=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s,"string"))?d:String(d))in this?Object.defineProperty(this,s,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[s]=o,!e)throw Error("registerKey is missing");if(this.registerKey=e,!t)throw Error("paramsGenerator is missing");this.paramsGenerator=t,this.config=r}}},620154:(e,t,r)=>{r.d(t,{wp:()=>h,hS:()=>f,NL:()=>T,nB:()=>L,eU:()=>I,WC:()=>A,Qr:()=>N,Qw:()=>M,kd:()=>y,lB:()=>k,O7:()=>v,i8:()=>b,DU:()=>U,RQ:()=>D});let i={UNIT:1,SUBDIVISION:2};var a=r(280179),n=r(288673),_=r(731433),s=r(314520),o=r(116600),d=r(392557),u=r(108174),c=r(210439),l=r(702820),p=r(438167),m=r(115694),g=r(550166),P=r(388124),E=r(642192);let O=e=>e.metrics;function T(e,t,r=O){return{type:"STERLING_INIT_REPORTING_TABLE",name:e,apiParams:t,processData:r}}function y(e){return{type:"AD_GROUPS_WITH_TEMPLATE_APPLIED",adGroupsWithTargetingTemplateApplied:e}}function R(e,t,r,i){return{type:"STERLING_REPORTING_TABLE_PROCESSING",name:e,isProcessing:t,actionType:r,viewer:i}}function A(e,t,r,i){return{type:"STERLING_REPORTING_TABLE_DATA_FAILURE",name:e,error:t,actionType:r,viewer:i}}function I(e,t){return{type:"STERLING_REPORTING_TABLE_SAVE_BREAKDOWN",name:e,breakdown:t}}function N(e,t,r,i,a){return n=>{(n(I(e,t)),null===t)?n({type:"STERLING_REPORTING_TABLE_REMOVE_BREAKDOWN",name:e}):n((0,E.em)(e,r,i,a))}}function h(e,t,r){let i={},a=e[0];if(1===e.length)return Object.keys(a).filter(e=>!g.KF.includes(e)).forEach(e=>{i[e]=a[e]}),i;let n=(0,c.QQ)(t,r).map(e=>e.field),_=Object.keys(a).filter(e=>!(g.KF.includes(e)||n.includes(e)||e in g.uE||e.includes("CUSTOM_COLUMN_"))),s=Object.keys(a).filter(e=>e in g.uE);return _.forEach(t=>{i[t]=e.reduce((e,r)=>e+("string"==typeof r[t]||r[t]instanceof String?parseFloat(r[t]):Number(r[t])),0)}),s.forEach(e=>{let t=e in g.uE?function(e,t){if(t.computeFn&&t.columns&&2===t.columns.length){let r=t.columns[0],i=t.columns[1],a=e[r],n=e[i];if("number"==typeof a&&"number"==typeof n&&a>=0&&n>=0)return t.computeFn(a,n)}return null}(i,g.uE[e]):null;t&&(i[e]=t)}),i}function w(e,t,r,i,a,n){return async _=>_((0,E.Xw)(e,t,r,i,a,n))}function f(e,t){return{type:"STERLING_REPORTING_TABLE_PARAM_CHANGE",name:e,apiParams:t}}function v(e,t,r,i,a,n,_,s){return o=>(o(R(e,!0,l.PR.SORT_TABLE,n)),o(f(e,{sort_column:"ORGANIC_PIN_ID"===t?"PIN_ID":t,sort_ascending:r,start_index:1})),o(w(e,i,a,n,_,s)))}function L(e,t,r,i,a,n,_){return(s,o)=>{let{rows:d,breakdown:u,totalResultCount:c}=o().reportingTables[e]||{},{page:p,perPage:m}=t,g=(p-1)*m,P=!1,E=Math.min(c,g+m-1);for(let e=g;e<E;e+=1)if(void 0===d[e]||u&&void 0===d[e].breakdown){P=!0;break}return P?(s(R(e,!0,l.PR.LOAD_TABLE,a)),s(w(e,r,i,a,n,_))):Promise.resolve()}}function D(e,t,r){return i=>(i({type:"STERLING_REPORTING_TABLE_UPDATE_ROW_DATA",name:e,id:t,rowData:r}),Promise.resolve())}function S(e){return Object.prototype.hasOwnProperty.call(e,"archived")||Object.prototype.hasOwnProperty.call(e,"paused")}function G(e,t,r,a,s,o,d=l.PR.INLINE_EDIT,u){return(c,l)=>{let p=l(),m=e.map(e=>{let t=(0,_.Z)(i)[e.PRODUCT_GROUP_TYPE],r={ad_group_id:Number(e.PRODUCT_GROUP_AD_GROUP_ID),product_group_type:t,bid:void 0,active:void 0};return e.PROMOTED_CATALOG_PRODUCT_GROUP_REFERENCE_ID&&(r.catalog_product_group_id=Number(e.PROMOTED_CATALOG_PRODUCT_GROUP_REFERENCE_ID),delete r.product_group_type),Object.prototype.hasOwnProperty.call(e,"bid")&&(r.bid=e.bid),Object.prototype.hasOwnProperty.call(e,"paused")&&(r.active=!e.paused),Object.prototype.hasOwnProperty.call(e,"included")&&(r.included=e.included),Object.prototype.hasOwnProperty.call(e,"tracking_url")&&(r.tracking_url=e.tracking_url),{action:"update",id:Number(e.id),data:r}});return c(R("productGroup",!0,d,a)),Promise.all((p.advertiser.id,Object.values(m.reduce((e,t)=>({...e,...t.data&&{[t.data.ad_group_id]:{ad_group_id:t.data.ad_group_id.toString(),promoted_catalog_product_groups:[...e[t.data.ad_group_id]?.promoted_catalog_product_groups||[],{id:t.id.toString(),status:t.data.active?"ACTIVE":"PAUSED",..."catalog_product_group_id"in t.data?{catalog_product_group_id:`${t.data.catalog_product_group_id||""}`}:{}}]}}}),{}))).map(e=>(0,n.zQ)({advertiser_id:p.advertiser.id},e))).then(i=>{var n;return(c(w("productGroup",t,r,a,s,o)),c((n="productGroup",async e=>e((0,E.UF)(n,t,r,a,s)))),i.length)?{errors:[],product_groups:i.flat().map((t,r)=>(c(D(u,t.data?.id||"",{...t.data,...e[r]})),t.data))}:i}).catch(e=>{throw c(A("productGroup",e,d,a)),e})}}function b(e,t,r,i,a,n,_,s,c=l.PR.INLINE_EDIT){let m={id:e,...r};return t===o.Lw.campaign?e=>e(function(e,t,r=l.PR.INLINE_EDIT){return(i,a)=>{let n=a(),_=new p.ZP,s=[{advertiser_id:n.advertiser.id,...e}];S(e)&&(s[0]={...s[0],status:Object.prototype.hasOwnProperty.call(e,"archived")&&e.archived?d.nD.ARCHIVED:Object.prototype.hasOwnProperty.call(e,"paused")&&e.paused?d.nD.PAUSED:d.nD.ACTIVE});let c=_.patchJSON(`/ads/v4/advertisers/${n.advertiser.id}/campaigns/`,s,!1,!0);return i(R(o.eX.campaign,!0,r,t)),c.then(e=>{if(e?.[0]?.exceptions)throw e[0].exceptions[0].message;return i(R(o.eX.campaign,!1,r,t)),(0,u.z5)(e)[0].data}).catch(e=>{throw i(A(o.eX.campaign,e,r,t)),e})}}(m,n,c)):t===o.Lw.adGroup?e=>e(function(e,t,r=l.PR.INLINE_EDIT){return(i,a)=>{let n=a(),_=new p.ZP,s=[{...e}];S(e)&&(s[0]={...s[0],status:Object.prototype.hasOwnProperty.call(e,"archived")&&e.archived?d.yJ.ARCHIVED:Object.prototype.hasOwnProperty.call(e,"paused")&&e.paused?d.yJ.PAUSED:d.yJ.ACTIVE});let c=_.patchJSON(`/ads/v4/advertisers/${n.advertiser.id}/ad_groups/`,function(e){let t={bid:"bid_in_micro_currency",budget:"budget_in_micro_currency"},r="budget";return e.map(e=>{let i={...e};return e.bid&&(i[t.bid]=e.bid,delete i.bid),e[r]&&(i[t[r]]=e[r],delete i[r]),i})}(s),!1,!0);return i(R(o.eX.adGroup,!0,r,t)),c.then(e=>{if(e?.[0]?.exceptions)throw e[0].exceptions[0].message;return i(R(o.eX.adGroup,!1,r,t)),(0,u.z5)(e)[0].data}).catch(e=>{throw i(A(o.eX.adGroup,e,r,t)),e})}}(m,n,c)):t===o.Lw.productGroup?e=>e(G([m],i,a,n,_,s,c,t)):t===o.Lw.pinPromotion?e=>e(function(e,t,r=l.PR.INLINE_EDIT){return(i,a)=>{let n=a(),_=new p.ZP,s=[{...e}];S(e)&&(s[0]={...s[0],status:Object.prototype.hasOwnProperty.call(e,"archived")&&e.archived?d.C5.ARCHIVED:Object.prototype.hasOwnProperty.call(e,"paused")&&e.paused?d.C5.PAUSED:d.C5.ACTIVE});let c=_.patchJSON(`/ads/v4/advertisers/${n.advertiser.id}/ads/`,s,!1,!0);return i(R(o.eX.pinPromotion,!0,r,t)),c.then(e=>{if(e?.[0]?.exceptions)throw e[0].exceptions[0].message;return i(R(o.eX.pinPromotion,!1,r,t)),(0,u.z5)(e)[0].data}).catch(e=>{throw i(A(o.eX.pinPromotion,e,r,t)),e})}}(m,n,c)):e=>e(function(e,t,r,i=l.PR.INLINE_EDIT){let a={id:e.id.toString()};return e.bid?a.bid=e.bid:0===e.bid&&(a.bid=-1),e.archived&&(a.archived=e.archived),(e,n)=>{e(R(t,!0,i,r));let _=n(),s={advertiser_id:_.advertiser.id,keywords:[a]};return new p.ZP().patchJSON(`ads/v4/advertisers/${_.advertiser.id}/keywords/`,s,!1,!0).then(a=>{if(e(R(t,!1,i,r)),a.errors.length)throw a.errors[0].error_messages[0];return a.keywords}).catch(a=>{let n=Error(a);throw e(A(t,n,i,r)),n})}}(m,t,n),c)}let C=new m.b(25);function U(e,t,r,i,n,_,o,d={},u,c){return(p,m)=>{p(R(e,!0,l.PR.UPDATE_MANY,o));let g={};if("productGroup"===r){let{updateEntityAdditionalDataFields:r=[]}=(0,s.AC)("PRODUCT_GROUP_ENTITY_STATUS",n,_)||{};return p(G(t.map(e=>{let t={id:e.id};return t={...t,...i,...d},r.forEach(r=>{t[r]=e[r]}),t}),n,_,o,u,c,l.PR.INLINE_EDIT,e))}return t.forEach(e=>{g[e.id]=()=>p(b(e.id,e.type,i,n,_,o,u,c,l.PR.UPDATE_MANY))}),C.process(g).then(t=>{for(let r in t.resolved){let i={...t.resolved[r],...d};p(D(e,r,i))}if(Object.keys(t.rejected).length>0)p(A(e,Object.keys(t.rejected).map(e=>t.rejected[e]).pop(),l.PR.UPDATE_MANY,o));else{var r;let t=m().reportingTables[e];p((r=t.rows,{type:"STERLING_REPORTING_TABLE_DATA_SUCCESS",name:e,rows:r,totalResultCount:t.totalResultCount,actionType:l.PR.UPDATE_MANY,viewer:o}))}n.checkExperiment("sterling_performance_improvements").anyEnabled&&(0,a.su)(l.Lf)})}}function M(e,t,r,i,a,n){return _=>(_((0,P.ky)(a)),_((0,E.ch)(e,t,r,i,a,n)))}function k(e){return{type:"STERLING_REPORTING_TABLE_ZERO_FILL",zeroFill:e}}},642192:(e,t,r)=>{r.d(t,{kP:()=>w,jr:()=>N,nz:()=>h,Mo:()=>L,fi:()=>f,UV:()=>v,jj:()=>G,vn:()=>D,Wv:()=>b,_m:()=>S,NU:()=>C,Xw:()=>H,ch:()=>et,UF:()=>x,em:()=>J,uL:()=>M});var i=r(920434),a=r(105737),n=r(372085),_=r(339001),s=r(116600),o=r(702820),d=r(839714),u=r(65456),c=r(479511),l=r(964982),p=r(620154),m=r(731495),g=r(994700),P=r(186959),E=r(308452),O=r(527734),T=r(288673);async function y(e,t,r,i,a,n,_){if(!i){if(_===s.eX.adGroupNegativeKeyword)throw Error("EXACTLY_ONE_AD_GROUP");throw Error("EXACTLY_ONE_CAMPAIGN")}let o=await (0,T.PG)({advertiser_id:e,parent_id:i,page_size:t,start_index:r,match_types:a,name:n});return{keywords:o.keywords,totalResultCount:o.total_result_count}}var R=r(729831),A=r(110071),I=r(953565);let N="STERLING_INIT_REPORTING_TABLE_START",h="STERLING_INIT_REPORTING_TABLE_SUCCESS",w="STERLING_INIT_REPORTING_TABLE_FAILURE",f="STERLING_REPORTING_TABLE_DATA_START",v="STERLING_REPORTING_TABLE_DATA_SUCCESS",L="STERLING_REPORTING_TABLE_DATA_FAILURE",D="STERLING_REPORTING_TABLE_SUMMARY_START",S="STERLING_REPORTING_TABLE_SUMMARY_SUCCESS",G="STERLING_REPORTING_TABLE_SUMMARY_FAILURE",b="STERLING_REPORTING_TABLE_SUMMARY_START_NO_PROCESSING_UPDATE",C="STERLING_REPORTING_TABLE_SUMMARY_SUCCESS_NO_PROCESSING_UPDATE",U=e=>e.metrics;function M(){return{type:"STERLING_REPORTING_TABLE_KEYWORD_UPDATED"}}function k(e,t){return{type:C,name:e,summaryRow:t}}let B=(e,t)=>(r,i)=>{if(!(0,E.Bd)(r,"SUMMARY_DATA",!0))return{shouldLoad:!1};let{anyEnabled:a}=e.checkExperiment("aid_exp_reporting_delivery_filter"),n=(0,l.te)((0,E.lX)(i,r,e,t)),_=(0,E.xn)(i,r);return{apiParams:{advertiser_id:n.advertiser,attribution_types:n.attribution_types,columns:n.columns,conversion_report_time:n.conversion_report_time,custom_column_ids:n.custom_columns,start_date:n.start_date,end_date:n.end_date,engagement_window_days:n.engagement_window_days,view_window_days:n.view_window_days,click_window_days:n.click_window_days,ingestion_sources:n.ingestion_sources,conversion_metric_type:n.conversion_metric_type,aggregate_report_rows:!0,bookmark:1,page_size:n.limit,granularity:"TOTAL",filters:(0,A.Zj)(r.filters,e,!1,!1),sort:{columns:n.unified_sort_columns?n.unified_sort_columns:[n.sort_column],ascending:n.sort_ascending},include_related_ad_groups:!1,include_related_campaigns:!1,include_related_pin_promotions:!1,should_zero_fill:!a||n.zero_fill,product_group_id:n.product_group_id},shouldUsePacingApi:_,shouldLoad:!0,name:i}};function X(e,t,r,i,n){return async(_,s)=>{let{anyEnabled:d}=t.checkExperiment("sterling_performance_improvements");_({type:b,name:e});let u=s(),c=(0,g.kO)(i);(0,I.nP)(`sterling.ads_reporting.${o.PR.LOAD_SUMMARY}.loading`,{sampleRate:1,tags:c});let l=B(t,r)(u,e),m=JSON.parse(JSON.stringify(l));try{if(!l.shouldLoad)return(0,I.nP)(`sterling.ads_reporting.${o.PR.LOAD_SUMMARY}.success`,{sampleRate:1,tags:c}),_(k(e,null));let i=await (0,O.x7)(l.apiParams,l.name,l.shouldUsePacingApi,n),u=s(),g=B(t,r)(u,e),P=JSON.parse(JSON.stringify(g));if(!(0,a.ZP)(m.apiParams,P.apiParams))return null;if(i){let a=(0,p.wp)(i,t,r);if(a.isSummary=!0,_(k(e,a)),d&&(0,O.Fr)(l.apiParams)){let i=await (0,O.yb)(l.apiParams,(0,O.lQ)(l.apiParams.advertiser_id,l.name),void 0,"adgroup"===l.name,n,(0,O.sx)(l.name),!1),s=(0,O.ue)([a],i.metrics,(0,O.$q)(l.name)),o=1===s.length?s[0]:(0,p.wp)(s,t,r);o.isSummary=!0,_(k(e,o))}}else _(k(e,null));return!0}catch(t){return(0,I.nP)(`sterling.ads_reporting.${o.PR.LOAD_SUMMARY}.failure`,{sampleRate:1,tags:c}),_({type:G,name:e,error:t,actionType:o.PR.LOAD_SUMMARY})}}}function x(e,t,r,i,a){return new c.ZP(c.mQ.LOAD_REPORTING_TABLE_SUMMARY,B(t,r)).getCacheThunkAction(X)(e,t,r,i,a)}function j(e,t,r){return{name:e,isProcessing:t,actionType:r,type:f}}function K(e,t,r,i,a){return{type:v,name:e,rows:r,totalResultCount:i,actionType:a}}function z(e,t,r){return{type:L,name:e,error:t,actionType:r}}async function Y(e,t){let r=Object.fromEntries((await (0,R.D)(e,t)).map(e=>[e.ad_id,{...e}]));return t.map((e,t)=>{let i=r[e.id]?.metrics?.map(r=>{let i=r.TARGETING_VALUE,a={...r,PIN_PROMOTION_AD_GROUP_NAME:e.PIN_PROMOTION_AD_GROUP_NAME,PIN_PROMOTION_CAMPAIGN_NAME:e.PIN_PROMOTION_CAMPAIGN_NAME,PIN_PROMOTION_AD_GROUP_ID:e.PIN_PROMOTION_AD_GROUP_ID,PIN_PROMOTION_CAMPAIGN_ID:e.PIN_PROMOTION_CAMPAIGN_ID};return"CAROUSEL_SLOT_INDEX"in r&&(i=r.CAROUSEL_SLOT_INDEX,e.carousel_destination_urls&&(a.destination_url=e.carousel_destination_urls[t])),a.PIN_PROMOTION_NAME=i,a.pin_id=e.pin_id,a.carousel_slot_index=t,a});return{...e,breakdown:i}})}async function Z(e,t,r,i){let a=await (0,R.n)({...e,columns:[...e.columns,"QUIZ_PIN_RESULT_OPEN"]},s.eX.pinPromotion,i);return t.map(e=>{let t=a.filter(t=>t.metrics.PIN_PROMOTION_ID===e.PIN_PROMOTION_ID).map(({metrics:t,...i})=>{let a="unknown"===i.targeting_value?"":i.targeting_value,n=e.quiz_pin_data?.results?.find(e=>e.organic_pin_id===a),s=n?.destination_url||"",o=n?.result_id||1;return{...i,PIN_PROMOTION_AD_GROUP_NAME:e.PIN_PROMOTION_AD_GROUP_NAME,PIN_PROMOTION_CAMPAIGN_NAME:e.PIN_PROMOTION_CAMPAIGN_NAME,PIN_PROMOTION_AD_GROUP_ID:e.PIN_PROMOTION_AD_GROUP_ID,PIN_PROMOTION_CAMPAIGN_ID:e.PIN_PROMOTION_CAMPAIGN_ID,PIN_PROMOTION_NAME:a?(0,_.nk)(r.bt("Wynik {{ result }}", "Result {{ result }}", "[m10n] targetingType.quizresults.viewType.reportingDashboard.row.adTitle", undefined, true),{result:String.fromCharCode(64+o)}):"",PIN_PROMOTION_ID:"string"==typeof t.PIN_PROMOTION_ID?t.PIN_PROMOTION_ID:"",QUIZ_COMPLETED:t.QUIZ_PIN_RESULT_OPEN,destination_url:s,PIN_ID:a,pin_id:a}});return{...e,breakdown:t}})}let F={[s.eX.campaign]:{idColumn:"CAMPAIGN_ID",nameColumn:"CAMPAIGN_NAME"},[s.eX.adGroup]:{idColumn:"AD_GROUP_ID",nameColumn:"AD_GROUP_NAME"},[s.eX.pinPromotion]:{idColumn:"PIN_PROMOTION_ID",nameColumn:"PIN_PROMOTION_NAME"},[s.eX.productItem]:{idColumn:"PRODUCT_ITEM_ID",nameColumn:"PRODUCT_ITEM_NAME"}};async function $(e,t,r,i,a,n,_,s){let{idColumn:o="",nameColumn:d=""}=F[r],u=await (0,R.n)(e,r,_,s);return t.map((e,t)=>{if(t<a||t>=n)return e;let r=u.filter(t=>e[o]===t.metrics[o]);if(0===r.length)return{...e,breakdown:null};let _=r.map(e=>{let t=e.targeting_value;if("PINNER_LIST_INCLUDE"===i||"AUDIENCE_INCLUDE"===i){let r=e.PINNER_LIST_NAME;r&&(t+=": "+r)}let{metrics:r,...a}=e;return{...a,...r,[d]:t}});return{...e,breakdown:_}})}function J(e,t,r,i){return async(a,n)=>{a(j(e,!0,o.PR.LOAD_TABLE));let _=n(),d=_.reportingTables[e],{breakdown:u}=d,c=d.rows.slice(0);if(0===c.length){a(j(e,!1,o.PR.LOAD_TABLE));let t=(0,g.kO)(i);return(0,I.nP)("sterling.ads_reporting.success",{sampleRate:1,tags:t}),Promise.resolve(c)}let l={...(0,E.lX)(e,_,t,r,!0),data_source:"OFFLINE",targeting_type:u,ad_group_ids:null,pin_promotion_ids:null},p=(0,E.sm)(_)-1,m=(0,P.iX)(_)||0,O=e===s.eX.productItem,T=p+m,y=c.slice(p,T),R=O?y.map(e=>e.INTERNAL_PRODUCT_ITEM_ID_STR):y.map(e=>e.id).join(","),A=O&&c&&c[0].PRODUCT_GROUP_ID?.toString()||null,N={advertiser_id:l.advertiser,entity_ids:R,start_date:l.start_date,end_date:l.end_date,targeting_types:[u],columns:l.columns,granularity:"TOTAL",click_window_days:l.click_window_days,engagement_window_days:l.engagement_window_days,view_window_days:l.view_window_days,conversion_report_time:l.conversion_report_time,attribution_types:l.attribution_types,custom_column_ids:l.custom_columns||[],ingestion_sources:l.ingestion_sources,conversion_metric_type:l.conversion_metric_type,sort_columns:l.sort_column?[l.sort_column]:void 0,sort_ascending:l.sort_ascending},h=[];try{switch(u){case"QUIZ_RESULT":h=await Z(N,c,r,t);break;case"SLOTS":h=await Y(N,c);break;default:h=await $(N,c,e,u,p,T,t,A)}}catch(t){return a(z(e,t,o.PR.LOAD_TABLE)),[]}return a(K(e,!1,h,d.totalResultCount,o.PR.LOAD_TABLE)),h}}let Q=(e,t)=>(r,i)=>{if(!(0,E.Bd)(r,"ALL_DATA",!0))return{shouldLoad:!1};let{breakdown:a}=r.reportingTables[i],n=(0,E.lX)(i,r,t,e),_=(0,E.xn)(i,r);_||(0,m.d)(r,e,t).columns.map(e=>e.field).forEach(e=>{e in l.qz&&n.columns.push(...l.qz[e])});let{anyEnabled:s}=t.checkExperiment("aid_exp_reporting_delivery_filter");return{apiParams:{advertiser_id:n.advertiser,attribution_types:n.attribution_types,columns:n.columns,conversion_report_time:n.conversion_report_time,custom_column_ids:n.custom_columns,start_date:n.start_date,end_date:n.end_date,engagement_window_days:n.engagement_window_days,view_window_days:n.view_window_days,click_window_days:n.click_window_days,ingestion_sources:n.ingestion_sources,include_related_campaigns:n.include_related_campaigns,include_related_ad_groups:n.include_related_ad_groups,include_related_pin_promotions:n.include_related_pin_promotions,aggregate_report_rows:!1,bookmark:n.start_index,page_size:n.limit,granularity:"TOTAL",filters:(0,A.Zj)(r.filters,t,!1,!1),sort:{columns:n.unified_sort_columns?n.unified_sort_columns:[n.sort_column],ascending:n.sort_ascending},should_zero_fill:!s||n.zero_fill,negative_keyword_params:(0,E.og)(r,i),product_group_id:n.product_group_id},name:i,shouldUsePacingApi:_,shouldLoad:!0,breakdown:a}},V=(e,t,r)=>{let i=e.slice(0);if(r&&r>1){let e=r-1;for(let r=0,a=t.length;r<a;r+=1)i[e]=t[r],e+=1}else i=t.slice(0);return i},q=async(e,t)=>{let r=t.map(e=>e.PROMOTED_CATALOG_PRODUCT_GROUP_REFERENCE_ID).filter(e=>void 0!==e)??[];if(null!=r&&r.length>0)try{let t=await (0,n.Z)({url:`/v3/catalogs/product_groups/product_count_by_ids/${e}/`,method:"GET",data:{product_group_ids:r}});return t.resource_response.data?.count_map??{}}catch(e){}return{}};function W(e,t,r,i,n,_,c){return async(g,P)=>{let T=c||o.PR.LOAD_TABLE;g(j(e,!0,T));let R=P(),A=Q(r,t)(R,e),I=JSON.parse(JSON.stringify(A));if(!A.shouldLoad)return g(K(e,!1,[],0,T));let N=R.reportingTables[e],{processData:h}=N;R.reporting.reportingPreference.customColumns&&R.reporting.reportingPreference.customColumns.length>0&&(A.apiParams.custom_column_ids&&A.apiParams.custom_column_ids.length>0?_({event_type:9330,view_type:184,view_parameter:2221,aux_data:{advertiser_id:n.advertiser?.id,owner_user_id:n.advertiser?.owner_user_id,custom_column_count:A.apiParams.custom_column_ids.length,static_column_count:A.apiParams.columns.length}}):_({event_type:9331,view_type:184,view_parameter:2221,aux_data:{advertiser_id:n.advertiser?.id,owner_user_id:n.advertiser?.owner_user_id,static_column_count:A.apiParams.columns.length}}));let w=N.rows?N.rows.slice(0):[];try{let _;let o=R.reportingTables.adgroup?.rows;if((0,E.eq)(A.name)){let e=A.apiParams.negative_keyword_params.parent_id,t=o?.find(t=>t.id===e);_=t&&t.is_automated_campaign?{keywords:[],totalResultCount:0}:await y(A.apiParams.advertiser_id,A.apiParams.page_size,A.apiParams.bookmark,A.apiParams.negative_keyword_params.parent_id,A.apiParams.negative_keyword_params.match_types,A.apiParams.negative_keyword_params.name,A.name)}else{if(A.name===s.eX.adGroupPositiveKeyword&&o?.length){let e=A.apiParams.filters.filter(e=>"AD_GROUP_ID"===e.field)[0];e&&e.value&&(e.value=e.value.filter(e=>{let t=o.find(t=>t.id===e);return t&&!t.is_automated_campaign}))}if(_=await (0,O.i$)(A.apiParams,A.name,A.shouldUsePacingApi,n,!1),A.name===s.eX.productGroup&&void 0!==R.advertiser&&void 0!==R.advertiser.merchant_id){let e=R.advertiser.merchant_id,t=await q(e,_.metrics);_.metrics.forEach(e=>{if(void 0!==t){let r=String(e.PROMOTED_CATALOG_PRODUCT_GROUP_REFERENCE_ID);e.productCount=t[r]}})}if(u.Z.isKeywordEntity(A.name)&&(0,d.Z)(t)){let e=await (0,O.Wq)(A.apiParams,!0,!1,n,!1),t=e.relatedAdGroups&&Object.keys(e.relatedAdGroups).filter(t=>e.relatedAdGroups&&"None"!==e.relatedAdGroups[t].targeting_profile_id);t&&t.length>0&&g&&g((0,p.kd)(t))}}let{anyEnabled:c}=t.checkExperiment("sterling_performance_improvements"),N=P(),f=Q(r,t)(N,e),v=JSON.parse(JSON.stringify(f));if(!(0,a.ZP)(I.apiParams,v.apiParams))return null;if(c){let t=(h||U)({..._,metrics:_.metrics?.slice(0,10)});w=V(w,t,A.apiParams.bookmark),g(K(e,!1,w,_.totalResultCount,T)),w=V(w,(h||U)(_),A.apiParams.bookmark);let r=(0,O.$q)(A.name);if((0,O.Fr)(A.apiParams)){let e=_.metrics?.map(e=>`${e[r]}`)||[],t={...A.apiParams,sort:{columns:["AD_GROUP_STATUS"],ascending:A.apiParams.sort.ascending},filters:[{field:r,value:e,operator:"in"}],bookmark:1};if(!((0,O.SO)(A.apiParams)&&!A.apiParams.aggregate_report_rows)&&e.length>0){let e=await (0,O.yb)(t,(0,O.lQ)(A.apiParams.advertiser_id,A.name),void 0,"adgroup"===A.name,n,(0,O.sx)(A.name),!1);_.metrics=(0,O.ue)(_.metrics,e.metrics,r),w=V(w,(h||U)(_),A.apiParams.bookmark)}}}else w=V(w,(h||U)(_),A.apiParams.bookmark);let L=(0,m.d)(R,r,t).columns.map(e=>e.field).some(e=>l.Bx.includes(e)),D=t.checkExperiment("aid_exp_campaign_planning_and_goals_alpha_1",{dangerouslySkipActivation:!0}).anyEnabled,{anyEnabled:S}=t.checkExperiment("aid_exp_reporting_delivery_filter");if((0,E.qg)(e)&&L&&w.length||D)try{await (0,l.vv)({advertiser:A.apiParams.advertiser_id,start_date:A.apiParams.start_date,end_date:A.apiParams.end_date,conversion_metric_type:A.apiParams.conversion_metric_type,ingestion_sources:A.apiParams.ingestion_sources,attribution_types:A.apiParams.attribution_types,conversion_report_time:A.apiParams.conversion_report_time,zero_fill:!S||A.apiParams.should_zero_fill},w)}catch(e){}if(g(K(e,!1,w,_.totalResultCount,T)),A.breakdown)return g(J(e,t,r,i))}catch(t){return g(z(e,t,T)),t}}}function H(e,t,r,i,a,n,_){return new c.ZP(c.mQ.LOAD_REPORTING_TABLE,Q(r,t)).getCacheThunkAction(W)(e,t,r,i,a,n,_)}let ee=(0,i.Z)((e,t,r,i,a,n,_)=>{Promise.all([e(H(t,r,i,a,n,_)),e(x(t,r,i,a,n))]).then(()=>{_({event_type:8109,component:13805})}).catch(r=>e(z(t,r,o.PR.LOAD_TABLE)))},250);function et(e,t,r,i,a,n){return _=>{_(j(e,!0,o.PR.LOAD_TABLE)),ee(_,e,t,r,i,a,n)}}},729831:(e,t,r)=>{r.d(t,{D:()=>P,n:()=>g});var i=r(372085),a=r(288673),n=r(116600),_=r(438167),s=r(115694),o=r(766520),d=r(110071);let u=async(e,t,r,a,s)=>{let u={api_version:"v4",entity_type:`${r}-targeting`};try{e.conversion_report_time&&(e.conversion_report_time=o.YH[e.conversion_report_time]);let c=(0,d.Up)(e),{anyEnabled:l}=a.checkExperiment("sterling_performance_improvements");if(l){let e=r===n.eX.productItem?await s({advertiser_id:c.advertiser_id},c):await s(c);return e.data?.map(e=>({targeting_type:String(e.targeting_type),targeting_value:String(e.targeting_value),PINNER_LIST_NAME:e.PINNER_LIST_NAME?String(e.PINNER_LIST_NAME):"",metrics:{...e.metrics}}))||[]}(0,d.y0)(u,c);let p=new Date,m=new _.ZP,g=r===n.eX.productItem?await (0,i.Z)({url:t(c.advertiser_id),method:"POST",data:{...c}}):await m.get(t(c.advertiser_id),c);if((0,d.BL)(u,p,new Date),(0,d.X7)(u),g.resource_response?.data)return g.resource_response.data;return g}catch(e){throw(0,d.CB)(u),e}},c=async({entity_ids:e,...t},r)=>u({...t,ad_ids:e},e=>`/ads/v4/advertisers/${e}/ads/targeting_metrics/`,n.eX.pinPromotion,r,a.qF),l=async({entity_ids:e,...t},r)=>u({...t,ad_group_ids:e},e=>`/ads/v4/advertisers/${e}/ad_groups/targeting_metrics/`,n.eX.adGroup,r,a.XV),p=async({entity_ids:e,...t},r)=>u({...t,campaign_ids:e},e=>`/ads/v4/advertisers/${e}/campaigns/targeting_metrics/`,n.eX.campaigns,r,a.bX),m=async({entity_ids:e,...t},r,i)=>{t.columns=["PRODUCT_ITEM_ID",...t.columns];let _=i?{...t,internal_product_item_ids:e,product_group_id:i}:{...t,internal_product_item_ids:e};return null!=t.sort_ascending&&(_.sort={columns:t.sort_columns||["SPEND_IN_DOLLAR"],ascending:!!t.sort_columns&&t.sort_ascending}),u(_,e=>`/ads/v4/advertisers/${e}/product_groups/product_item_targeting_metrics/`,n.eX.productItem,r,a.Js)},g=async(e,t,r,i)=>{switch(t){case n.eX.campaign:return p(e,r);case n.eX.adGroup:return l(e,r);case n.eX.pinPromotion:return c(e,r);case n.eX.productItem:return m(e,r,i);default:throw Error("Not supported")}},P=async(e,t)=>{let r={...t.map(t=>{let r=(0,d.Up)({ad_id:t.id,advertiser_id:e.advertiser_id,start_date:e.start_date,end_date:e.end_date,columns:e.columns,granularity:e.granularity,click_window_days:e.click_window_days,engagement_window_days:e.engagement_window_days,view_window_days:e.view_window_days,conversion_report_time:e.conversion_report_time,attribution_types:e.attribution_types,ingestion_sources:e.ingestion_sources,conversion_metric_type:e.conversion_metric_type});return()=>(0,a.ke)(r).then(e=>({ad_id:t.id,...e}))})};return new s.b(10).process(r).then(({resolved:e})=>Object.values(e))}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/99964.pl_PL-86a9c7dcec0d9a77.mjs.map